---
title: "Creation of Yellowtail Flounder ageing datasets for OpenData"
author: "Daniel Ricard"
date: "January 8, 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gulf)
library(ggplot2)
```

## Yellowtail Flounder
Yellowtail Flounder otoliths are collected on the annual September RV survey and during scientific sampling of commercial fisheries.

The goal here is to summarise the ageing materials that we have, and provide a dataset of the otoliths that we have at the Gulf Fisheries Centre.


```{r yellowtail}
## RV data
y <- read.card(species=42, card.type="bio")

## commercial data
## what years are available for commercial ages?
## com.files <- list.files(path="//DFNBE1CwpFSP002/Hd2/commercial/age", pattern="wfage")
y.c <- read.card(year=1982, sampling="commercial", species=42, card.type="age") ## this loads all pre-1982 commercial ages

rv.df <- aggregate(fish.number~year+month, data=y[which(y$age.material==1),], length)
rv.df$source <- "RV"
names(rv.df)[3] <- "number.otoliths_nombre.otolithes"

comm.df <- aggregate(otolith.number~year+month, data=y.c, length)
names(comm.df)[3] <- "number.otoliths_nombre.otolithes"
comm.df$source <- "Commercial"


yellowtail.out.df <- rbind(rv.df, comm.df)
yellowtail.out.df$latin.name_nom.latin <- "Limanda ferruginea"
yellowtail.out.df$english.name_nom.anglais <- "Yellowtail Flounder"
yellowtail.out.df$french.name_nom.français <- "Limande à queue jaune"


vars <- c("source", "latin.name_nom.latin", "english.name_nom.anglais", "french.name_nom.français", "year","month","number.otoliths_nombre.otolithes")
o1 <- order(yellowtail.out.df$source, yellowtail.out.df$year, yellowtail.out.df$month)

yellowtail.out.fn <- "NAFO-4T-Yellowtail-Flounder-ages.csv"
write.csv(yellowtail.out.df[o1,vars], file=yellowtail.out.fn, row.names = FALSE)
  
## and a so-called data dictionary to explain the different columns in the CSV file
data.dic <- data.frame(
  name_nom = vars
  )
data.dic$description_fr <- c("Source de otolithes, peut soit provenir du relevé par navire de recherche (Research Vessel (RV)) ou d'échantillonnage des pêches commerciales (Commercial)", "Nom latin de l'espèce", "Nom anglais de l'espèce", "Nom français de l'espèce", "Année d'échantillonnage des otolithes", "Mois d'échantillonnage des otolithes", "Nombre d'otolithes dans la collection")

data.dic$description_en <- c("Source of otoliths, can be either from the Research Vessel (RV) survey or from commercial sampling (Commercial)", "Latin name of the species", "English name of the species", "French name of the species", "Year when otoliths were collected", "Month when otolith were collected", "Number of otoliths in collection")

data.dic.fn <- "data-dictionary.csv"
write.csv(data.dic, file=data.dic.fn, row.names = FALSE)
```

The Web Service to be associated with this dataset will just be a polygon of NAFO division 4T.



